import{E as h,h as F,s as p}from"./socket.58ec5154.js";import{_ as w,e as M,f as T,E as q,g as N,h as C,j as I,o,c as a,a as e,t as r,k as l,l as y,n as A,d as c,w as g,v as b,F as x,r as O,q as V,p as z,m as B,b as j}from"./index.c631c08b.js";const W={name:"Event",components:{Form:M,Field:T,ErrorMessage:q},data(){const s=N().shape({user:C().required("Please select the user")}),t=N().shape({name:C().required("Name is required!"),description:C()});return{event:{},invitations:[],contacts:[],isCreationOfInvitationActive:!1,isChangerActive:!1,invitationLoading:!1,eventLoading:!1,eventDeletionLoading:!1,disableAllEventFields:!1,message:"",invitationSchema:s,eventSchema:t}},mounted(){h.getEvent(this.$route.params.eventId).then(s=>{this.event=s.data.event},s=>{alert("Error retrieving event dta")}),h.getEventInvitations(this.$route.params.eventId).then(s=>{this.invitations=s.data.invitations},s=>{alert("Error retrieving invitations data")}),this.getUninvitedContacts()},methods:{getTimeWithTimeZone(s){const t=new Date(s);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)},getUninvitedContacts(){h.getUninvitedContacts(this.$route.params.eventId).then(s=>{this.contacts=s.data.contacts},s=>{alert("Error retrieving contacts data")})},getMoment(s){return F(s).calendar()},handleInvitation(s){this.loading=!0,h.createInvitationEvent(parseInt(this.$route.params.eventId),parseInt(s.user)).then(t=>{this.invitations.push(t.data.invitation),this.isCreationOfInvitationActive=!1,this.contacts=[],this.loading=!1,this.getUninvitedContacts()},t=>{this.loading=!1,this.message=t.response&&t.response.data&&t.response.data.message||t.message||t.toString()})},handleDeleteInvitation(s){s.loading=!0,h.deleteEventInvitation(s.event.id,s.id).then(t=>{console.log(this.invitations.splice(this.invitations.indexOf(s),1)),this.contacts=[],s.loading=!1,this.getUninvitedContacts()},t=>{alert("Error deleting invitation")})},handleUpdation(s){this.eventLoading=!0,h.updateEvent(this.$route.params.eventId,s).then(t=>{this.event=t.data.event,this.isChangerActive=!1},t=>{this.eventLoading=!1,this.message=t.response&&t.response.data&&t.response.data.message||t.message||t.toString()})},handleDeletion(){this.eventDeletionLoading=!1,h.deleteEvent(this.$route.params.eventId).then(s=>{this.$router.push("/events")},s=>{this.eventDeletionLoading=!1})}},created(){p.connect(),p.on("change card",({content:s,to:t})=>{console.log("change card: ",s);const f=this.invitations.find(E=>E.id===t);f&&(this.invitations[this.invitations.indexOf(f)].status=s)})},destroyed(){p.off("change card"),p.disconnect()}},d=s=>(z("data-v-23197292"),s=s(),B(),s),Z={class:"container"},P={class:"jumbotron"},G={key:0},H={class:"col-md-12"},J={class:"card card-container"},K={class:"form-group"},Q=d(()=>e("label",{for:"name"},"Name of event",-1)),R={class:"form-group"},X=d(()=>e("label",{for:"description"},"description",-1)),Y={class:"form-group"},$=d(()=>e("label",{for:"date"},"Date and time",-1)),ee={class:"form-group"},te=["disabled"],se={class:"spinner-border spinner-border-sm"},ne=d(()=>e("span",null,"Update event",-1)),ie={key:1},oe={class:"col-md-12"},ae={class:"card card-container"},re={class:"form-group"},le=d(()=>e("label",{for:"user"},"Select user to invite",-1)),de=d(()=>e("option",{disabled:"",selected:""},"Select user",-1)),ce=["value"],ve={class:"form-group"},he=["disabled"],ue={class:"spinner-border spinner-border-sm"},me=d(()=>e("span",null,"Invite user to event",-1)),_e={key:2},pe=["disabled"],ge={class:"spinner-border spinner-border-sm"},be=d(()=>e("span",null,"Delete event",-1)),fe=d(()=>e("h3",null,"Invitations:",-1)),ke={key:0},Ce=d(()=>e("p",null,"No invitations yet",-1)),Ie=[Ce],ye={key:1,class:"list-group"},Ee={key:1},Se=["onClick","disabled"],Ue={class:"spinner-border spinner-border-sm"},De=j(" Cancel invitation ");function Le(s,t,f,E,n,v){var U,D,L;const m=I("Field"),_=I("ErrorMessage"),S=I("Form");return o(),a("div",Z,[e("header",P,[e("h2",null,"Event "+r((U=n.event)==null?void 0:U.name),1)]),n.isChangerActive?(o(),a("div",G,[e("div",H,[e("div",J,[l(S,{onSubmit:v.handleUpdation,"validation-schema":n.eventSchema},{default:y(()=>{var i,u,k;return[e("div",K,[Q,l(m,{name:"name",type:"text",class:"form-control",value:(i=n.event)==null?void 0:i.name},null,8,["value"]),l(_,{name:"name",class:"error-feedback"})]),e("div",R,[X,l(m,{name:"description",type:"text",class:"form-control",value:(u=n.event)==null?void 0:u.description},null,8,["value"]),l(_,{name:"description",class:"error-feedback"})]),e("div",Y,[$,l(m,{name:"date",type:"datetime-local",class:"form-control",value:v.getTimeWithTimeZone((k=n.event)==null?void 0:k.date)},null,8,["value"]),l(_,{name:"date",class:"error-feedback"})]),e("div",ee,[e("button",{class:"btn btn-primary btn-block",disabled:n.eventLoading},[g(e("span",se,null,512),[[b,n.eventLoading]]),ne],8,te)])]}),_:1},8,["onSubmit","validation-schema"]),n.message?(o(),a("div",{key:0,class:A(["alert","alert-danger"])},r(n.message),1)):c("",!0),e("button",{class:"btn btn-danger btn-block",onClick:t[0]||(t[0]=i=>n.isChangerActive=!1)},"Cancel")])])])):c("",!0),n.isCreationOfInvitationActive?(o(),a("div",ie,[e("div",oe,[e("div",ae,[l(S,{onSubmit:v.handleInvitation,"validation-schema":n.invitationSchema},{default:y(()=>[e("div",re,[le,l(m,{name:"user",as:"select"},{default:y(()=>[de,(o(!0),a(x,null,O(n.contacts,(i,u)=>(o(),a("option",{key:u,value:i.firstUser?i.firstUser.id:i.secondUser.id},r(i.firstUser?i.firstUser.firstName:i.secondUser.firstName)+" "+r(i.firstUser?i.firstUser.lastName:i.secondUser.lastName),9,ce))),128))]),_:1}),l(_,{name:"user",class:"error-feedback"})]),e("div",ve,[e("button",{class:"btn btn-primary btn-block",disabled:n.invitationLoading},[g(e("span",ue,null,512),[[b,n.invitationLoading]]),me],8,he)])]),_:1},8,["onSubmit","validation-schema"]),n.message?(o(),a("div",{key:0,class:A(["alert","alert-danger"])},r(n.message),1)):c("",!0),e("button",{class:"btn btn-danger btn-block",onClick:t[1]||(t[1]=i=>n.isCreationOfInvitationActive=!1)},"Cancel")])])])):c("",!0),!n.isCreationOfInvitationActive&&!n.isChangerActive?(o(),a("div",_e,[e("p",null,r((D=n.event)==null?void 0:D.description),1),e("p",null,r(v.getMoment((L=n.event)==null?void 0:L.date)),1),e("button",{class:"btn btn-primary btn-block",onClick:t[2]||(t[2]=i=>n.isChangerActive=!0)},"Change event"),e("button",{class:"btn btn-danger btn-block",onClick:t[3]||(t[3]=(...i)=>v.handleDeletion&&v.handleDeletion(...i)),disabled:n.eventDeletionLoading},[g(e("span",ge,null,512),[[b,n.eventDeletionLoading]]),be],8,pe),fe,e("button",{class:"btn btn-primary btn-block",onClick:t[4]||(t[4]=i=>n.isCreationOfInvitationActive=!0)},"Invite user"),n.invitations.length?c("",!0):(o(),a("div",ke,Ie)),n.invitations.length?(o(),a("ul",ye,[(o(!0),a(x,null,O(n.invitations,(i,u)=>(o(),a("li",{class:"list-group-item",key:u},[e("p",null,r(i.user.firstName)+" "+r(i.user.lastName),1),i.status?(o(),a("p",{key:0,style:V([i.status.id===2?{color:"red"}:i.status.id===3?{color:"orange"}:{color:"limegreen"}])},r(i.status.nameEn),5)):c("",!0),i.status?c("",!0):(o(),a("p",Ee,"No answer yet")),e("p",null,r(i.user.username),1),e("button",{class:"btn btn-danger btn-block",onClick:k=>v.handleDeleteInvitation(i),disabled:i.loading},[g(e("span",Ue,null,512),[[b,i.loading]]),De],8,Se)]))),128))])):c("",!0)])):c("",!0)])}var xe=w(W,[["render",Le],["__scopeId","data-v-23197292"]]);export{xe as default};
